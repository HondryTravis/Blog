---
title: è®¾è®¡æ¨¡å¼
---

è®¾è®¡æ¨¡å¼ä¸ºäº†è§£å†³æ„å»ºå¤§å‹åº”ç”¨çš„å¥å£®æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ç›®å‰å·²çŸ¥çš„é«˜è¾¾ 23 ç§ã€‚

## å•ä¾‹æ¨¡å¼

### å®šä¹‰

å•ä¾‹æ¨¡å¼ï¼Œä¹Ÿå«å•å­æ¨¡å¼ï¼Œæ˜¯ä¸€ç§å¸¸ç”¨çš„è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œå±äºåˆ›å»ºå‹æ¨¡å¼çš„ä¸€ç§ **ä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹**ã€‚åœ¨åº”ç”¨è¿™ä¸ªæ¨¡å¼æ—¶ï¼Œå•ä¾‹å¯¹è±¡çš„ç±»å¿…é¡»ä¿è¯åªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨ã€‚è®¸å¤šæ—¶å€™æ•´ä¸ªç³»ç»Ÿåªéœ€è¦æ‹¥æœ‰ä¸€ä¸ªçš„å…¨å±€å¯¹è±¡ï¼Œè¿™æ ·æœ‰åˆ©äºæˆ‘ä»¬åè°ƒç³»ç»Ÿæ•´ä½“çš„è¡Œä¸ºã€‚æ¯”å¦‚åœ¨æŸä¸ªæœåŠ¡å™¨ç¨‹åºä¸­ï¼Œè¯¥æœåŠ¡å™¨çš„é…ç½®ä¿¡æ¯å­˜æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè¿™äº›é…ç½®æ•°æ®ç”±ä¸€ä¸ªå•ä¾‹å¯¹è±¡ç»Ÿä¸€è¯»å–ï¼Œç„¶åæœåŠ¡è¿›ç¨‹ä¸­çš„å…¶ä»–å¯¹è±¡å†é€šè¿‡è¿™ä¸ªå•ä¾‹å¯¹è±¡è·å–è¿™äº›é…ç½®ä¿¡æ¯ã€‚è¿™ç§æ–¹å¼ç®€åŒ–äº†åœ¨å¤æ‚ç¯å¢ƒä¸‹çš„é…ç½®ç®¡ç†ã€‚

### å®ç°æ€è·¯

ä¸€ä¸ªç±»èƒ½è¿”å›å¯¹è±¡ä¸€ä¸ªå¼•ç”¨(æ°¸è¿œæ˜¯åŒä¸€ä¸ª)å’Œä¸€ä¸ªè·å¾—è¯¥å®ä¾‹çš„æ–¹æ³•ï¼ˆå¿…é¡»æ˜¯é™æ€æ–¹æ³•ï¼Œé€šå¸¸ä½¿ç”¨getInstanceè¿™ä¸ªåç§°ï¼‰ï¼›å½“æˆ‘ä»¬è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œå¦‚æœç±»æŒæœ‰çš„å¼•ç”¨ä¸ä¸ºç©ºå°±è¿”å›è¿™ä¸ªå¼•ç”¨ï¼Œå¦‚æœç±»ä¿æŒçš„å¼•ç”¨ä¸ºç©ºå°±åˆ›å»ºè¯¥ç±»çš„å®ä¾‹å¹¶å°†å®ä¾‹çš„å¼•ç”¨èµ‹äºˆè¯¥ç±»ä¿æŒçš„å¼•ç”¨ï¼›åŒæ—¶æˆ‘ä»¬è¿˜å°†è¯¥ç±»çš„æ„é€ å‡½æ•°å®šä¹‰ä¸ºç§æœ‰æ–¹æ³•ï¼Œè¿™æ ·å…¶ä»–å¤„çš„ä»£ç å°±æ— æ³•é€šè¿‡è°ƒç”¨è¯¥ç±»çš„æ„é€ å‡½æ•°æ¥å®ä¾‹åŒ–è¯¥ç±»çš„å¯¹è±¡ï¼Œåªæœ‰é€šè¿‡è¯¥ç±»æä¾›çš„é™æ€æ–¹æ³•æ¥å¾—åˆ°è¯¥ç±»çš„å”¯ä¸€å®ä¾‹ã€‚

### æ„å»ºæ–¹å¼

- æ‡’æ±‰æ–¹å¼ã€‚æŒ‡å…¨å±€çš„å•ä¾‹å®ä¾‹åœ¨ç¬¬ä¸€æ¬¡è¢«ä½¿ç”¨æ—¶æ„å»ºã€‚
- é¥¿æ±‰æ–¹å¼ã€‚æŒ‡å…¨å±€çš„å•ä¾‹å®ä¾‹åœ¨ç±»è£…è½½æ—¶æ„å»ºã€‚

### TypeScript å®ç°

```ts
/* æ‡’æ±‰æ¨¡å¼ */
class Singleton {
  private static instance: Singleton = null;
  constructor() {}
  public static getInstance(): Singleton {
    if (this.instance == null) {
      this.instance = new Singleton();
    }
    return this.instance;
  }
  public test() {
    console.log('å•ä¾‹');
  }
}
const xx = Singleton.getInstance();
const xx2 = Singleton.getInstance();
// xx.test();
console.log(xx == xx2);

/* é¥¿æ±‰æ¨¡å¼ */
class Singleton {
  private static instance: Singleton = new Singleton();
  constructor() {}
  public static getInstance(): Singleton {
    return this.instance;
  }
  public test() {
    console.log('å•ä¾‹');
  }
}
const xx = Singleton.getInstance();
const xx2 = Singleton.getInstance();
// xx.test();
console.log(xx == xx2);
```

## å·¥ç¨‹æ¨¡å¼

### ç®€è¿°

åœ¨é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­ï¼Œå·¥å‚é€šå¸¸æ˜¯ä¸€ä¸ªç”¨æ¥åˆ›å»ºå…¶ä»–å¯¹è±¡çš„å¯¹è±¡ã€‚å·¥å‚æ˜¯æ„é€ æ–¹æ³•çš„æŠ½è±¡ï¼Œç”¨æ¥å®ç°ä¸åŒçš„åˆ†é…æ–¹æ¡ˆã€‚

å·¥å‚å¯¹è±¡é€šå¸¸åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ–¹æ³•ï¼Œç”¨æ¥åˆ›å»ºè¿™ä¸ªå·¥å‚æ‰€èƒ½åˆ›å»ºçš„å„ç§ç±»å‹çš„å¯¹è±¡ã€‚è¿™äº›æ–¹æ³•å¯èƒ½æ¥æ”¶å‚æ•°ï¼Œç”¨æ¥æŒ‡å®šå¯¹è±¡åˆ›å»ºçš„æ–¹å¼ï¼Œæœ€åè¿”å›åˆ›å»ºçš„å¯¹è±¡ã€‚

æœ‰æ—¶ï¼Œç‰¹å®šç±»å‹å¯¹è±¡çš„æ§åˆ¶è¿‡ç¨‹æ¯”ç®€å•åœ°åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ›´å¤æ‚ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå·¥å‚å¯¹è±¡å°±æ´¾ä¸Šç”¨åœºäº†ã€‚å·¥å‚å¯¹è±¡å¯èƒ½ä¼šåŠ¨æ€åœ°åˆ›å»ºäº§å“ç±»çš„å¯¹è±¡ï¼Œæˆ–è€…ä»å¯¹è±¡æ± ä¸­è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ–è€…å¯¹æ‰€åˆ›å»ºçš„å¯¹è±¡è¿›è¡Œå¤æ‚çš„é…ç½®ï¼Œæˆ–è€…åº”ç”¨å…¶ä»–çš„æ“ä½œã€‚

è¿™äº›ç±»å‹çš„å¯¹è±¡å¾ˆæœ‰ç”¨ã€‚å‡ ä¸ªä¸åŒçš„è®¾è®¡æ¨¡å¼éƒ½åº”ç”¨äº†å·¥å‚çš„æ¦‚å¿µï¼Œå¹¶å¯ä»¥ä½¿ç”¨åœ¨å¾ˆå¤šè¯­è¨€ä¸­ã€‚ä¾‹å¦‚ï¼Œåœ¨ã€Šè®¾è®¡æ¨¡å¼ã€‹ä¸€ä¹¦ä¸­ï¼Œåƒå·¥å‚æ–¹æ³•æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€ç”Ÿæˆå™¨æ¨¡å¼ï¼Œç”šè‡³æ˜¯å•ä¾‹æ¨¡å¼éƒ½åº”ç”¨äº†å·¥å‚çš„æ¦‚å¿µã€‚

### TypeScript å®ç°

ç®€å•æ¥è®²å°±æ˜¯éšè—äº† new çš„è¿‡ç¨‹

```ts
/* å·¥å‚æ¨¡å¼ */
abstract class Person {
    public abstract say(): void;
}

class Women extends Person {
    public say(): void {
        console.log('æˆ‘æ˜¯å¥³çš„')
    }
}

class Man extends Person {
    public say(): void {
        console.log('æˆ‘æ˜¯ç”·çš„')
    }
}

class God {
    public static TYPE_MAN: number = 1
    public static TYPE_WOMEN: number = 0
    public static TYPE_Animal: number = 3
    public static createPerson(type): Person {
        switch (type){
            case God.TYPE_MAN:
                return new Man();
            case God.TYPE_WOMEN:
                return new Women();
            // switch ç©¿é€
            case God.TYPE_Animal:
            default:
                return new Man()
        }
    }
}

const man = God.createPerson(God.TYPE_MAN)
man.say()
```

## ä»£ç†æ¨¡å¼

### ç®€è¿°

ä»£ç†æ¨¡å¼ï¼ˆè‹±è¯­ï¼šProxy Patternï¼‰æ˜¯ç¨‹åºè®¾è®¡ä¸­çš„ä¸€ç§è®¾è®¡æ¨¡å¼ã€‚

æ‰€è°“çš„ä»£ç†è€…æ˜¯æŒ‡ä¸€ä¸ªç±»åˆ«å¯ä»¥ä½œä¸ºå…¶å®ƒä¸œè¥¿çš„æ¥å£ã€‚ä»£ç†è€…å¯ä»¥ä½œä»»ä½•ä¸œè¥¿çš„æ¥å£ï¼šç½‘ç»œè¿æ¥ã€å­˜å‚¨å™¨ä¸­çš„å¤§å¯¹è±¡ã€æ–‡ä»¶æˆ–å…¶å®ƒæ˜‚è´µæˆ–æ— æ³•å¤åˆ¶çš„èµ„æºã€‚

è‘—åçš„ä»£ç†æ¨¡å¼ä¾‹å­ä¸ºå¼•ç”¨è®¡æ•°ï¼ˆè‹±è¯­ï¼šreference countingï¼‰æŒ‡é’ˆå¯¹è±¡ã€‚

å½“ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„å¤šä»½å‰¯æœ¬é¡»å­˜åœ¨æ—¶ï¼Œä»£ç†æ¨¡å¼å¯ä»¥ç»“åˆäº«å…ƒæ¨¡å¼ä»¥å‡å°‘å­˜å‚¨å™¨ç”¨é‡ã€‚å…¸å‹ä½œæ³•æ˜¯åˆ›å»ºä¸€ä¸ªå¤æ‚å¯¹è±¡åŠå¤šä¸ªä»£ç†è€…ï¼Œæ¯ä¸ªä»£ç†è€…ä¼šå¼•ç”¨åˆ°åŸæœ¬çš„å¤æ‚å¯¹è±¡ã€‚è€Œä½œç”¨åœ¨ä»£ç†è€…çš„è¿ç®—ä¼šè½¬é€åˆ°åŸæœ¬å¯¹è±¡ã€‚ä¸€æ—¦æ‰€æœ‰çš„ä»£ç†è€…éƒ½ä¸å­˜åœ¨æ—¶ï¼Œå¤æ‚å¯¹è±¡ä¼šè¢«ç§»é™¤ã€‚

ç®€å•æ¥è®²ï¼Œä¸ºä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç”¨å“æˆ–å ä½ç¬¦ï¼Œä»¥ä¾¿æ§åˆ¶å¯¹å®ƒçš„è®¿é—®ã€‚å¾ˆå¤šæ˜æ˜Ÿéƒ½æœ‰è‡ªå·±ç»çºªäººï¼Œæ¯”å¦‚å¼€æ¼”å”±ä¼šï¼Œç»çºªäººä¼šä»£æ›¿æ˜æ˜Ÿç»†èŠ‚å’Œè°ˆå¥½æŠ¥é…¬ä¹åå†è·Ÿæ˜æ˜Ÿç­¾åˆåŒã€‚å³æ ¸å¿ƒæ˜¯å½“å®¢æˆ·ä¸æ–¹ä¾¿ç›´æ¥è®¿é—®ä¸€ä¸ªå¯¹è±¡æˆ–è€…ä¸æ»¡è¶³éœ€è¦çš„æ—¶å€™ï¼Œæä¾›ä¸€ä¸ªæ›¿èº«å¯¹è±¡æ§åˆ¶è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ï¼Œæ›¿èº«å¯¹å®¶å¯¹è¯·æ±‚æœ€åˆä¸€äº›å¤„ç†ä¹‹åå†æŠŠè¯·æ±‚è½¬äº¤ç»™æœ¬ä½“å¯¹è±¡ã€‚

### TypeScript å®ç°

```ts
interface IDirector {
    save(): void;
}

class User implements IDirector {
    public save(): void {
        console.log('æ‰§è¡ŒæˆåŠŸ congratulationsï¼')
    }
}

class DirectorProxy implements IDirector {
    private target: IDirector
    constructor(target: IDirector) {
        this.target = target
    }
    save(): void {
        console.log('ğŸ¼ å¼€å§‹æ‰§è¡Œäº‹åŠ¡â€¦â€¦')
        this.target.save()
        console.log('ğŸ äº‹åŠ¡ç»“æŸ')
    }
}

const user: IDirector = new User();
const directorProxy: IDirector = new DirectorProxy(user)

directorProxy.save()
```

## å‘½ä»¤æ¨¡å¼

### ç®€è¿°

å‘½ä»¤æ¨¡å¼ä¸­çš„å‘½ä»¤æŒ‡çš„æ˜¯ä¸€ä¸ªæ‰§è¡ŒæŸäº›ç‰¹å®šäº‹æƒ…çš„æŒ‡ä»¤ï¼Œæœ‰æ—¶å€™éœ€è¦å‘æŸäº›ç‰¹å®šäº‹æƒ…çš„æŒ‡ä»¤ã€‚å¸¸è§çš„åº”ç”¨åœºæ™¯æœ‰æ—¶å€™éœ€è¦å‘æŸäº›å¯¹å®¶å‘é€è¯·æ±‚ï¼Œä½†æ˜¯å¹¶ä¸çŸ¥é“è¯·æ±‚çš„æ¥å—è€…æ˜¯è°ï¼Œä¹Ÿä¸çŸ¥é“è¢«è¯·æ±‚çš„æ“ä½œæ˜¯ä»€ä¹ˆã€‚å‡å¦‚æˆ‘ä»¬å»å¿«é¤åº—ï¼Œå¯ä»¥ç‚¹é¤ã€å–æ¶ˆã€ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸ç”¨å…³å¿ƒå¨å¸ˆæ˜¯è°åº•ä¹ˆåšã€‚

### TypeScript å®ç°

```ts
// å®šä¹‰æ¥å—è€…
class Receiver {
    public action(): void {
        console.log('æ‰§è¡Œæ“ä½œ')
    }
}

// æŠ½è±¡å‘½ä»¤è§’è‰²ç±»
interface ICommand {
    exec(): void;
}

// å…·ä½“å‘½ä»¤è§’è‰²ç±»
class ConcreteCommand implements ICommand {
    private receiver: Receiver = null!;
    constructor(receiver: Receiver){
        this.receiver = receiver
    }
    public exec(): void {
        this.receiver.action()
    }
}

// è§’è‰²ç±»
class Invoker {
    private command: Command;
    constructor(command: Command){
        this.command = command
    }
    public action(): void {
        this.command.exec();
    }
}
const receiver: Receiver = new Receiver();
const command: Command = new ConcreteCommand(receiver);

const invoker: Invoker = new Invoker(command);
invoker.action();
```

## è§‚å¯Ÿè€…æ¨¡å¼

åœ¨æ­¤ç§æ¨¡å¼ä¸­ï¼Œä¸€ä¸ªç›®æ ‡å¯¹è±¡ç®¡ç†æ‰€æœ‰ç›¸ä¾äºå®ƒçš„è§‚å¯Ÿè€…å¯¹è±¡ï¼Œå¹¶ä¸”åœ¨å®ƒæœ¬èº«çš„çŠ¶æ€æ”¹å˜æ—¶ä¸»åŠ¨å‘å‡ºé€šçŸ¥ã€‚

è¿™é€šå¸¸é€è¿‡å‘¼å«å„è§‚å¯Ÿè€…æ‰€æä¾›çš„æ–¹æ³•æ¥å®ç°ã€‚æ­¤ç§æ¨¡å¼é€šå¸¸è¢«ç”¨æ¥å®æ—¶äº‹ä»¶å¤„ç†ç³»ç»Ÿ

è§‚å¯Ÿè€…æ¨¡å¼æœ‰å››ä¸ªè§’è‰²ï¼šæŠ½è±¡ç›®æ ‡ã€å…·ä½“ç›®æ ‡ã€æŠ½è±¡è§‚å¯Ÿè€…ã€å…·ä½“è§‚å¯Ÿè€…ã€‚

### æŠ½è±¡ç›®æ ‡

æ­¤æŠ½è±¡ç±»åˆ«æä¾›ä¸€ä¸ªç•Œé¢è®©è§‚å¯Ÿè€…è¿›è¡Œæ·»é™„ä¸è§£é™„ä½œä¸šã€‚æ­¤ç±»åˆ«å†…æœ‰ä¸ªä¸å…¬å¼€çš„è§‚å¯Ÿè€…ä¸²è”ï¼Œå¹¶é€è¿‡ä¸‹åˆ—å‡½å¼(æ–¹æ³•)è¿›è¡Œä½œä¸š

- æ·»é™„(Attach)ï¼šæ–°å¢è§‚å¯Ÿè€…åˆ°ä¸²è”å†…ï¼Œä»¥è¿½è¸ªç›®æ ‡å¯¹è±¡çš„å˜åŒ–ã€‚
- è§£é™„(Detach)ï¼šå°†å·²ç»å­˜åœ¨çš„è§‚å¯Ÿè€…ä»ä¸²è”ä¸­ç§»é™¤ã€‚
- é€šçŸ¥(Notify)ï¼šåˆ©ç”¨è§‚å¯Ÿè€…æ‰€æä¾›çš„æ›´æ–°å‡½å¼æ¥é€šçŸ¥æ­¤ç›®æ ‡å·²ç»äº§ç”Ÿå˜åŒ–ã€‚

æ·»é™„å‡½å¼åŒ…æ¶µäº†ä¸€ä¸ªè§‚å¯Ÿè€…å¯¹è±¡å‚æ•°ã€‚ä¹Ÿè®¸æ˜¯è§‚å¯Ÿè€…ç±»åˆ«çš„è™šæ‹Ÿå‡½å¼(å³æ›´æ–°å‡½å¼)ï¼Œæˆ–æ˜¯åœ¨éé¢å‘å¯¹è±¡çš„è®¾å®šä¸­æ‰€ä½¿ç”¨çš„å‡½å¼æŒ‡æ ‡(æ›´å¹¿æ³›æ¥è®²ï¼Œå‡½å¼å­æˆ–æ˜¯å‡½å¼å¯¹è±¡)

ç®€å•è®²ï¼šè§‚å¯Ÿè€…æ¨¡å¼(åˆç§°ä¸ºå‘å¸ƒ-è®¢é˜…æ¨¡å¼)ï¼Œå®ƒå®šä¹‰å¯¹å®¶é—´çš„ä¸€ç¥ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ä¸»æ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–å®ƒçš„å¯¹è±¡éƒ½å°†å¾—åˆ°é€šå’Œã€‚ç°å®ä¸»æ´»ä¸­ï¼Œå¦‚æˆ‘ä»¬å»å”®æ¥¼ä¸­å¿ƒæœåŠ¡äººå‘˜Aæ¥å¾…æˆ‘ä»¬ï¼Œç„¶åå†æœ‰å®¢æˆ·æ‰¾åˆ°Aï¼Œè¿™ä¸ªæ—¶å€™æš‚æ—¶æ²¡æˆ¿ï¼Œç­‰åˆ°æœ‰æˆ¿çš„æ—¶å€™ä¸å¯èƒ½æœåŠ¡äººå‘˜AæŒ¨ä¸ªæ‰“ç”µè¯é€šå’Œè€Œæ˜¯è®¢é˜…Açš„å…¬å…±æé†’æœåŠ¡ã€‚

### å…·ä½“ç›®æ ‡

æ­¤ç±»åˆ«æä¾›äº†è§‚å¯Ÿè€…æ¬²è¿½è¸ªçš„çŠ¶æ€ã€‚ä¹Ÿåˆ©ç”¨å…¶æºç±»åˆ«(ä¾‹å¦‚å‰è¿°çš„æŠ½è±¡ç›®æ ‡ç±»åˆ«)æ‰€æä¾›çš„æ–¹æ³•,æ¥é€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…å…¶çŠ¶æ€å·²ç»æ›´æ–°ã€‚æ­¤ç±»åˆ«æ‹¥æœ‰ä»¥ä¸‹å‡½å¼

- å–å¾—çŠ¶æ€(GetState)ï¼šå›ä¼ è¯¥ç›®æ ‡å¯¹è±¡çš„çŠ¶æ€

### æŠ½è±¡è§‚å¯Ÿè€…

æŠ½è±¡è§‚å¯Ÿè€…ç±»åˆ«æ˜¯ä¸€ä¸ªå¿…é¡»è¢«å®åšçš„æŠ½è±¡ç±»åˆ«ã€‚è¿™ä¸ªç±»åˆ«å®šä¹‰äº†æ‰€æœ‰è§‚å¯Ÿè€…éƒ½æ‹¥æœ‰çš„æ›´æ–°ç”¨ç•Œé¢ï¼Œæ­¤ç•Œé¢æ˜¯ç”¨æ¥æ¥æ”¶ç›®æ ‡ç±»åˆ«æ‰€å‘å‡ºçš„æ›´æ–°é€šçŸ¥ã€‚æ­¤ç±»åˆ«å«æœ‰ä»¥ä¸‹å‡½å¼

- æ›´æ–°(Update)ï¼šä¼šè¢«å®åšçš„ä¸€ä¸ªæŠ½è±¡(è™šæ‹Ÿ)å‡½å¼

### è§‚å¯Ÿè€…

è¿™ä¸ªç±»åˆ«å«æœ‰æŒ‡å‘ç›®æ ‡ç±»åˆ«çš„å‚è€ƒ(reference)ï¼Œä»¥æ¥æ”¶æ¥è‡ªç›®æ ‡ç±»åˆ«çš„æ›´æ–°çŠ¶æ€ã€‚æ­¤ç±»åˆ«å«æœ‰ä»¥ä¸‹å‡½å¼

- æ›´æ–°(Update)ï¼šæ˜¯å‰è¿°æŠ½è±¡å‡½å¼çš„å®åšã€‚å½“è¿™ä¸ªå‡½å¼è¢«ç›®æ ‡å¯¹è±¡å‘¼å«æ—¶ï¼Œè§‚å¯Ÿè€…å¯¹è±¡å°†ä¼šå‘¼å«ç›®æ ‡å¯¹è±¡çš„å–å¾—çŠ¶æ€å‡½å¼ï¼Œæ¥å…¶æ‰€æ‹¥æœ‰çš„æ›´æ–°ç›®æ ‡å¯¹è±¡èµ„è®¯ã€‚

æ¯ä¸ªè§‚å¯Ÿè€…ç±»åˆ«éƒ½è¦å®åšå®ƒè‡ªå·±çš„æ›´æ–°å‡½å¼ï¼Œä»¥åº”å¯¹çŠ¶æ€æ›´æ–°çš„æƒ…å½¢ã€‚

å½“ç›®æ ‡å¯¹è±¡æ”¹å˜æ—¶ï¼Œä¼šé€šè¿‡å‘¼å«å®ƒè‡ªå·±çš„é€šçŸ¥å‡½å¼æ¥å°†é€šçŸ¥é€ç»™æ¯ä¸€ä¸ªè§‚å¯Ÿè€…å¯¹è±¡ï¼Œè¿™ä¸ªé€šçŸ¥å‡½å¼åˆ™ä¼šå»å‘¼å«å·²ç»æ·»é™„åœ¨ä¸²è”å†…çš„è§‚å¯Ÿè€…æ›´æ–°å‡½å¼ã€‚é€šçŸ¥ä¸æ›´æ–°å‡½å¼å¯èƒ½ä¼šæœ‰ä¸€äº›å‚æ•°ï¼Œå¥½æŒ‡æ˜æ˜¯ç›®å‰ç›®æ ‡å¯¹è±¡å†…çš„ä½•ç§æ”¹å˜ã€‚è¿™ä¹ˆä½œå°†å¯å¢è¿›è§‚å¯Ÿè€…çš„æ•ˆç‡(åªæ›´æ–°é‚£äº›æ”¹å˜éƒ¨åˆ†çš„çŠ¶æ€)

### ç”¨é€”

- å½“æŠ½è±¡ä¸ªä½“æœ‰ä¸¤ä¸ªäº’ç›¸ä¾èµ–çš„å±‚é¢æ—¶ã€‚å°è£…è¿™äº›å±‚é¢åœ¨å•ç‹¬çš„å¯¹è±¡å†…å°†å¯å…è®¸ç¨‹åºå‘˜å•ç‹¬åœ°å»å˜æ›´ä¸é‡å¤ä½¿ç”¨è¿™äº›å¯¹è±¡ï¼Œè€Œä¸ä¼šäº§ç”Ÿä¸¤è€…ä¹‹é—´äº¤äº’çš„é—®é¢˜ã€‚
- å½“å…¶ä¸­ä¸€ä¸ªå¯¹è±¡çš„å˜æ›´ä¼šå½±å“å…¶ä»–å¯¹è±¡ï¼Œå´åˆä¸çŸ¥é“å¤šå°‘å¯¹è±¡å¿…é¡»è¢«åŒæ—¶å˜æ›´æ—¶ã€‚
- å½“å¯¹è±¡åº”è¯¥æœ‰èƒ½åŠ›é€šçŸ¥å…¶ä»–å¯¹è±¡ï¼Œåˆä¸åº”è¯¥çŸ¥é“å…¶ä»–å¯¹è±¡çš„å®åšç»†èŠ‚æ—¶ã€‚

### C# å®ç°

```cs
// observe.cs
using System;
using System.Collections.Generic;

namespace observe
{
    public abstract class IObserver
    {
        public abstract void Update();
    }
    public abstract class ISubject
    {
        private List<IObserver> observers = new List<IObserver>();

        public void Add(IObserver observer) => observers.Add(observer);

        public void Remove(IObserver observer) => observers.Remove(observer);

        public void Notify()
        {
            Console.WriteLine("é€šçŸ¥æ‰€æœ‰æ›´æ–°");
            foreach (var o in observers) {
                o.Update();
            }
        }
    }
    public class Subject : ISubject
    {
        public string State { get; set; }
    }
    public class Observer : IObserver
    {
        private string _name;
        private string _state;
        private Subject subject;
        public Observer(Subject sub, string name)
        {
            subject = sub;
            _name = name;
        }
        public override void Update()
        {
            _state = subject.State;
        }
    }
}

// Program.cs
using System;

namespace observe
{
    class Program
    {
        static void Main(string[] args)
        {
            var subject = new Subject();
            subject.Add(new Observer(subject, "1"));
            subject.Add(new Observer(subject, "2"));

            subject.State = "changed";
            subject.Notify();
        }
    }
}
```

### TypeScript å®ç°

æ‚å¿—è®¢é˜…æœåŠ¡

```ts
interface IObservable {
    update(version: number): void
}

interface ISubscribe {
    add(key: string, obj: IObservable): void
    delete(key: string): void
    notify(): void
}

class MagazineSubscribe implements ISubscribe {
    private observers: Map<string, IObservable> = new Map<string, IObservable>()
    private version: number = 0
    public add(key: string, obj: IObservable): void{
        this.observers.set(key, obj)
    }
    public delete(key: string): void{
        if(this.observers.has(key)) {
            this.observers.delete(key)
        }else {
            throw new Error('key not found')
        }
    }
    public notify(): void{
        for(const [key, instance] of this.observers) {
            const o: IObservable = instance
            instance.update(this.version)
        }
    }
    public publish():void {
        this.version ++
        this.notify()
    }
}

class CustomObservable implements IObservable {
    private name: string
    private version: number
    constructor(name){
        this.name = name
    }
    public update(version: number):void {
        this.version = version
        console.log('è¯¥æ‚å¿—å‡ºæ–°ç‰ˆäº†ï¼Œéœ€è¦è´­ä¹°ï¼Ÿ')
        this.buy()
    }
    public buy():void {
        console.log(`${this.name}è´­ä¹°äº†${this.version}æœŸæ‚å¿—`)
    }
}


const magzaine = new MagazineSubscribe()

const k = new CustomObservable('å° K')
const j = new CustomObservable('å° J')

magzaine.add('k',k)
magzaine.add('j',j)
magzaine.publish()
magzaine.publish()

```

## èŒè´£é“¾æ¨¡å¼

### ç®€è¿°

ä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œä»è€Œé¿å…è¯·æ±‚çš„å‘é€è€…å’Œæ¥å—è€…ä¹é—´çš„è€¦åˆå…³ç³»ï¼Œå°†è¿™äº›å…³ç³»è¿æˆä¸€æ¡é“¾ï¼Œå¹¶æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¯¥è¯·æ±‚ï¼Œç›´åˆ°ä¸€ä¸ªå¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚ç°å®ç”Ÿæ´»ä¸­å¦‚æˆ‘ä»¬åº§å…¬äº¤åˆäººå¤ªå¤šï¼Œæˆ‘ä»¬æŠŠå…¬äº¤å¡äº¤ç»™å”®ç¥¨å‘˜ï¼Œè®©å‰é¢çš„äººä¸åœçš„å¾€å‰é€’ç›´åˆ°å”®ç¥¨å‘˜åˆ·å¡ç»“æŸ

### TypeScript å®ç°

çœ‹ä¸€ä¸ªè¯·å‡çš„å°ä¾‹å­

```ts
abstract class Handler {
  public sucesser: Handler;
  // å®šä¹‰ä¸€ä¸ªæŠ½è±¡çš„å¤„ç†è¯·æ±‚çš„æ–¹æ³•
  public abstract handlerRequest(user: string, days: number): void;

  // è·å–å½“å‰è§’è‰²çš„ä¸‹ä¸€ä¸ªå¤„ç†è€…è§’è‰²
  public getNextHandler(): Handler {
    return this.sucesser;
  }
  // è®¾ç½®å½“å‰è§’è‰²çš„ä¸‹ä¸€ä¸ªå¤„ç†è€…è§’è‰²
  public setNextHandler(sucesser: Handler): void {
    this.sucesser = sucesser;
  }
}
// ç­ä¸»ä»»å¤„ç†è¯·å‡è¯·æ±‚
class HeadTeacher extends Handler {
  public handlerRequest(user: string, days: number): string {
    if (days < 5) {
      console.log('ç­ä¸»ä»»åŒæ„' + user + 'åŒå­¦çš„è¯·å‡è¯·æ±‚');
    } else {
      console.log('ç­ä¸»ä»»æ— æ³•å¤„ç†' + user + 'åŒå­¦çš„è¯·å‡è¯·æ±‚');
    }
    // å¦‚æœä¸‹ä¸€ä¸ªæ‰§è¡Œè€…ä¸ä¸ºç©ºï¼Œç”±ä¸‹ä¸€ä¸ªæ‰§è¡Œè€…æ‰§è¡Œ
    if (this.getNextHandler() != null) {
      const nextHandler = this.getNextHandler();
      nextHandler.handlerRequest(user, days);
      return;
      // return this.getNextHandler().handlerRequest(user, days);
    }
    return null;
  }
}
// é™¢ç³»ä¸»ä»»å¤„ç†è¯·å‡è¯·æ±‚
class Department extends Handler {
  public handlerRequest(user: string, days: number): string {
    if (days < 30) {
      console.log('é™¢ç³»ä¸»ä»»åŒæ„' + user + 'åŒå­¦çš„è¯·å‡è¯·æ±‚');
    } else {
      console.log('é™¢ç³»ä¸»ä»»æ— æ³•å¤„ç†' + user + 'åŒå­¦çš„è¯·å‡è¯·æ±‚');
    }
    if (this.getNextHandler() != null) {
      const nextHandler = this.getNextHandler();
      nextHandler.handlerRequest(user, days);
      return;
    }
    return null;
  }
}
// æ ¡çº§ä¸»ä»»å¤„ç†è¯·å‡è¯·æ±‚
class Leader extends Handler {
  public handlerRequest(user: string, days: number): string {
    if (days >= 30) {
      console.log('æ ¡çº§ä¸»ä»»åŒæ„' + user + 'åŒå­¦çš„è¯·å‡è¯·æ±‚');
    } else if (this.getNextHandler() != null) {
      const nextHandler = this.getNextHandler();
      nextHandler.handlerRequest(user, days);
      return;
      // return getNextHandler().handlerRequest(user, days);
    }
    return null;
  }
}
class SimpleFactory {
  public static TYPE_HeadTeacher: number = 1;
  public static TYPE_Department: number = 2;
  public static TYPE_Leader: number = 3;

  public static createHandler(type: number): Handler {
    switch (type) {
      case SimpleFactory.TYPE_HeadTeacher:
        return new HeadTeacher();
      case SimpleFactory.TYPE_Department:
        return new Department();
      case SimpleFactory.TYPE_Leader:
      default:
        return new Leader();
    }
  }
}
// è·å–ä¸‰ä¸ªä¸åŒçš„å¤„ç†è€…å¯¹è±¡
const h1: Handler = SimpleFactory.createHandler(SimpleFactory.TYPE_HeadTeacher);
const h2: Handler = SimpleFactory.createHandler(SimpleFactory.TYPE_Department);
const h3: Handler = SimpleFactory.createHandler(SimpleFactory.TYPE_Leader);
// è®¾ç½®è§’è‰²çš„å¤„ç†å±‚æ¬¡
h1.setNextHandler(h2);
h2.setNextHandler(h3);

h1.handlerRequest('æå››', 35);
// console.log("*************************");
// h2.handlerRequest("ç‹äº”", 15);
// console.log("*************************");
// h2.handlerRequest("æœ±ä¸ƒ", 30);
```

## ç­–ç•¥æ¨¡å¼

### ç®€è¿°

ç­–ç•¥æ¨¡å¼ä½œä¸ºä¸€ç§è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼ŒæŒ‡å¯¹è±¡æœ‰æŸä¸ªè¡Œä¸ºï¼Œä½†æ˜¯åœ¨ä¸åŒçš„åœºæ™¯ä¸­ï¼Œè¯¥è¡Œä¸ºæœ‰ä¸åŒçš„å®ç°ç®—æ³•ã€‚æ¯”å¦‚æ¯ä¸ªäººéƒ½è¦â€œäº¤ä¸ªäººæ‰€å¾—ç¨â€ï¼Œä½†æ˜¯â€œåœ¨ç¾å›½äº¤ä¸ªäººæ‰€å¾—ç¨â€å’Œâ€œåœ¨ä¸­å›½äº¤ä¸ªäººæ‰€å¾—ç¨â€å°±æœ‰ä¸åŒçš„ç®—ç¨æ–¹æ³•ã€‚

ç­–ç•¥æ¨¡å¼

- å®šä¹‰äº†ä¸€æ—ç®—æ³•ï¼ˆä¸šåŠ¡è§„åˆ™ï¼‰
- å°è£…äº†æ¯ä¸ªç®—æ³•
- è¿™æ—çš„ç®—æ³•å¯äº’æ¢ä»£æ›¿ï¼ˆinterchangeableï¼‰

### TypeScript å®ç°

```ts
interface IStrategy {
    execute(): void
}


class ConcreteStrategyA implements IStrategy{
    execute(): void {
        console.log('æˆ‘æ˜¯ç­–ç•¥ A')
    }
}
class ConcreteStrategyB implements IStrategy{
    execute(): void {
        console.log('æˆ‘æ˜¯ç­–ç•¥ B')
    }
}
class ConcreteStrategyC implements IStrategy{
    execute(): void {
        console.log('æˆ‘æ˜¯ç­–ç•¥ C')
    }
}


class Context {
    private strategy: IStrategy
    constructor(strategy: IStrategy) {
        this.strategy = strategy
    }
    public execute() {
        this.strategy.execute()
    }
}

// ç­–ç•¥ A
const testA = new Context(new ConcreteStrategyA())
testA.execute()
const testB = new Context(new ConcreteStrategyB())
testB.execute()
const testC = new Context(new ConcreteStrategyC())
testC.execute()
```
